<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title th:text="${club.name} + ' - 게시판'">게시판</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
</head>
<body class="bg-deep"
      th:data-msg="${msg}"
      th:data-error="${error}"
      th:data-open-login="${openLogin}"
      th:data-open-register="${openRegister}">

<header class="topbar" th:replace="~{fragments/common :: topbar}"></header>

<div class="wrap">
    <aside class="sidebar" th:replace="~{fragments/common :: sidebar}"></aside>

    <main class="content">
        <form class="toolbar" th:replace="~{fragments/common :: searchbar}"></form>

        <div class="detail-card">
            <div th:replace="~{fragments/common :: club-tabs}"></div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; margin-top: 30px;">
            <h2 style="margin: 0; font-size: 24px;">게시판</h2>
            <a th:if="${isAlreadyMember}"
               th:href="@{/clubs/{clubId}/board/new(clubId=${club.id})}"
               class="btn primary">
                ✏️ 글쓰기
            </a>
        </div>

        <div class="post-grid-container">
            <div class="post-card" th:each="post : ${posts}">
                <div class="card-header">
                    <img th:if="${post.author.imageUrl != null}"
                         th:src="${post.author.imageUrl}"
                         class="profile-thumb" alt="프로필">

                    <div th:unless="${post.author.imageUrl != null}"
                         class="profile-thumb"
                         style="display: flex; align-items: center; justify-content: center; font-size: 20px;">
                        👤
                    </div>

                    <div class="author-info">
                        <span class="author-name" th:text="${post.author.nickname}">작성자</span>
                        <span class="post-date" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}">날짜</span>
                    </div>
                </div>

                <div class="card-content">
                    <div class="post-title">
                        <a th:href="@{/clubs/{clubId}/board/{postId}(clubId=${club.id}, postId=${post.id})}"
                           th:text="${post.title}">제목</a>
                    </div>
                    <p class="post-preview" th:text="${post.content}">내용 미리보기가 여기에 나옵니다.</p>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(posts)}" class="no-posts-message">
                아직 작성된 게시물이 없습니다. 첫 번째 글을 남겨보세요!
            </div>
        </div>
    </main>
</div>

<div th:replace="~{fragments/common :: modals}"></div>
<div th:replace="~{fragments/common :: scripts}"></div>

<div id="toast"
     th:if="${error != null or msg != null}"
     th:text="${error ?: msg}"
     class="toast show">
</div>

<script th:if="${openLogin}">
    document.addEventListener("DOMContentLoaded", () => modal("loginModal", true));
</script>
<script th:if="${openRegister}">
    document.addEventListener("DOMContentLoaded", () => modal("registerModal", true));
</script>

</body>
</html>