<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title th:text="${club.name} + ' - ëª¨ì„ ìƒì„¸'">ëª¨ì„ ìƒì„¸</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <style>
        .club-header h1 { margin: 0; font-size: 2.5rem; color: var(--text-main); font-weight: 800; letter-spacing: -1px; }
        .club-chips { margin-top: 12px; }

        .club-image { width: 100%; border-radius: 12px; background: #f0f0f0; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        img.club-image { max-height: 70vh; object-fit: contain; display: block; }
        div.club-image { height: 360px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); }

        .section-title { font-size: 1.2rem; font-weight: 600; margin-top: 0; margin-bottom: 12px; color: var(--primary-dark); border-left: 4px solid var(--primary); padding-left: 10px; }
        .detail-divider { border: none; border-top: 1px solid var(--border); margin: 24px 0; }

        .member-list { display: flex; flex-direction: column; gap: 10px; }
        .member-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-body); border-radius: 10px; border: 1px solid var(--border); }
        .member-avatar { width: 36px; height: 36px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center; color: #aaa; }
        .member-role { font-size: 0.8rem; color: var(--primary); font-weight: 700; margin-left: 6px; background: var(--primary-light); padding: 2px 8px; border-radius: 4px; }

        .activity-bar-bg { background: #eee; border-radius: 4px; overflow: hidden; width: 100%; height: 8px; margin-top: 6px; }
        .activity-bar-fill { background: var(--primary); height: 100%; border-radius: 4px; transition: width 0.5s; }

        .policy-badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-right: 6px; vertical-align: middle; }
        .policy-auto { background-color: #e8f5e9; color: #388e3c; border: 1px solid #388e3c; }
        .policy-approval { background-color: #fff3e0; color: #f57c00; border: 1px solid #f57c00; }
    </style>
</head>
<body class="bg-deep">

<header class="topbar" th:replace="~{fragments/common :: topbar}"></header>

<div class="wrap">

    <aside class="sidebar" th:replace="~{fragments/common :: sidebar}"></aside>

    <main class="content">

        <div class="detail-card" th:object="${club}">
            <div th:replace="~{fragments/common :: club-tabs}"></div>
        </div>

        <div class="detail-card" th:object="${club}">

            <div class="club-header">
                <h1 th:text="*{name}">ëª¨ì„ ì´ë¦„</h1>

                <div class="chips club-chips" style="display: flex; align-items: center; flex-wrap: wrap; gap: 6px;">
                    <span th:if="${club.joinPolicy.name() == 'AUTOMATIC'}" class="policy-badge policy-auto">ìë™ ê°€ì…</span>
                    <span th:if="${club.joinPolicy.name() == 'APPROVAL'}" class="policy-badge policy-approval">ìŠ¹ì¸ì œ</span>
                    <span class="chip" th:each="k : *{categories}" th:text="${'#' + k}">#ì¹´í…Œê³ ë¦¬</span>
                </div>
            </div>

            <hr class="detail-divider"> <div>
            <img th:if="*{imageUrl != null}" th:src="*{imageUrl}" alt="ëª¨ì„ ì‚¬ì§„" class="club-image">
            <div th:if="*{imageUrl == null}" class="club-image">
                (ë“±ë¡ëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤)
            </div>
        </div>

            <hr class="detail-divider"> <div>
            <h2 class="section-title">ëª¨ì„ ì„¤ëª…</h2>
            <p th:text="*{description}" style="min-height: 80px; white-space: pre-wrap; margin-top: 0; line-height: 1.6; color: var(--text-main);">ëª¨ì„ ì„¤ëª…...</p>
        </div>

            <hr class="detail-divider"> <div>
            <h2 class="section-title">í™œë™ ì§€í‘œ</h2>
            <div class="info-group" style="margin-top: 20px;">
                <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 15px; color: var(--text-main);">ìµœê·¼ ì¼ì • ì¶œì„ë¥ </h3>

                <div th:if="${not #lists.isEmpty(activityStats)}" style="display: flex; flex-direction: column; gap: 15px;">
                    <div th:each="stat : ${activityStats}" style="background: var(--bg-body); padding: 15px; border-radius: 10px; border: 1px solid var(--border);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.9em;">
                        <span style="font-weight: bold; color: var(--text-main);">
                            <span th:text="${stat.date}" style="color: var(--text-muted); margin-right: 8px; font-weight: normal;">2025-11-04</span>
                            <span th:text="${stat.title}">ì¼ì • ì œëª©</span>
                        </span>
                            <span style="color: var(--primary); font-weight: bold;">
                            <span th:text="${stat.rate} + '%'">80%</span>
                            <span style="color: var(--text-muted); font-weight: normal; font-size: 0.85em;"
                                  th:text="' (' + ${stat.attendedMember} + '/' + ${stat.totalMember} + 'ëª…)'"></span>
                        </span>
                        </div>

                        <div class="activity-bar-bg">
                            <div class="activity-bar-fill" th:style="'width: ' + ${stat.rate} + '%;'"></div>
                        </div>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(activityStats)}" style="text-align: center; padding: 30px; color: var(--text-muted); background: var(--bg-body); border-radius: 10px; border: 1px dashed var(--border);">
                    ì•„ì§ ì§„í–‰ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

            <hr class="detail-divider"> <div>
            <h2 class="section-title" th:text="'ëª¨ì„ ë©¤ë²„ (' + ${memberCount} + ')'">ëª¨ì„ ë©¤ë²„ (0)</h2>
            <div class="member-list">
                <div class="member-item" th:each="memberInfo : *{members}" style="align-items: center;">
                    <div class="member-avatar">ğŸ‘¤</div>

                    <div style="display: flex; align-items: center;">
                        <span th:text="${memberInfo.nickname}" style="font-weight: 500;">ë©¤ë²„ ë‹‰ë„¤ì„</span>

                        <span class="member-role"
                              th:if="${memberInfo.role == 'ADMIN' or memberInfo.role == 'MANAGER'}">
                            [ê´€ë¦¬ì]
                        </span>
                    </div>
                </div>

                <div th:if="${memberCount == 0}">
                    <p style="color: var(--text-muted); font-size: 14px; margin-top: 10px; margin-bottom: 0;">
                        ì•„ì§ ëª¨ì„ì— ê°€ì…í•œ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

            <hr class="detail-divider"> <div>
            <button th:if="${session.LOGIN_USER_ID == null}" class="btn primary block" id="openLoginBtn" style="padding: 12px;">
                ë¡œê·¸ì¸ í›„ ê°€ì…í•˜ê¸°
            </button>
            <button th:if="${isOwner}" class="btn block" disabled style="background: var(--bg-body); cursor: default;">
                ë‹¹ì‹ ì€ ì´ ëª¨ì„ì˜ ê´€ë¦¬ìì…ë‹ˆë‹¤
            </button>
            <button th:if="${club.myStatus == 'ACTIVE' and !isOwner}" class="btn block" disabled
                    style="background: var(--bg-body); color: var(--primary); cursor: default; border-color: var(--primary);">
                ì´ë¯¸ ê°€ì…í•œ ëª¨ì„ì…ë‹ˆë‹¤
            </button>

            <button th:if="${club.myStatus == 'WAITING'}" class="btn block" disabled
                    style="background: #fff8e1; color: #ffa000; border: 1px solid #ffa000; cursor: not-allowed;">
                ê°€ì… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤
            </button>

            <button th:if="${club.myStatus == 'BANNED'}" class="btn btn-danger block" disabled>
                ê°€ì…ì´ ì°¨ë‹¨ëœ ëª¨ì„ì…ë‹ˆë‹¤
            </button>

            <form th:if="${session.LOGIN_USER_ID != null && !isOwner && !isAlreadyMember}"
                  th:action="@{/clubs/{id}/join(id=${club.id})}" method="post" style="margin: 0;">

                <button type="submit" class="btn primary block" style="padding: 12px; font-size: 1rem;">
                    <span th:if="${club.joinPolicy.name() == 'AUTOMATIC'}">ê°€ì…í•˜ê¸°</span>
                    <span th:if="${club.joinPolicy.name() == 'APPROVAL'}">ê°€ì… ì‹ ì²­í•˜ê¸°</span>
                </button>

                <p th:if="${club.joinPolicy.name() == 'APPROVAL'}"
                   style="text-align: center; color: #ffa000; font-size: 12px; margin-top: 8px; margin-bottom: 0;">
                    ê´€ë¦¬ìì˜ ìŠ¹ì¸ í›„ í™œë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </form>
        </div>

            <div th:if="${isAlreadyMember and !isOwner}"
                 style="margin-top: 30px; border-top: 1px solid var(--border); padding-top: 15px; display: flex; justify-content: flex-end;">

                <button type="button"
                        class="btn"
                        onclick="openLeaveModal()"
                        style="font-size: 13px; color: var(--text-muted); background: transparent; border: 1px solid var(--border); cursor: pointer;">
                    ëª¨ì„ íƒˆí‡´í•˜ê¸°
                </button>
            </div>

        </div> </main>
</div>
<div th:replace="~{fragments/common :: modals}"></div>

<div id="toast"
     th:if="${error != null or msg != null}"
     th:text="${error ?: msg}"
     class="toast show">
</div>

<div th:replace="~{fragments/common :: scripts}"></div>

<div id="leaveModal" class="modal" style="display: none;">
    <div class="modal-card" style="text-align: center; width: 360px;">
        <h3 style="margin-top: 0; color: var(--text-main);">ëª¨ì„ íƒˆí‡´</h3>
        <p style="color: var(--text-muted); margin: 20px 0;">
            ì •ë§ë¡œ ì´ ëª¨ì„ì—ì„œ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?<br>
            ì‘ì„±í•œ ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </p>
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button type="button" class="btn" onclick="closeLeaveModal()">ì·¨ì†Œ</button>

            <form th:action="@{/clubs/{id}/leave(id=${club.id})}" method="post">
                <button type="submit" class="btn btn-danger">ë„¤, íƒˆí‡´í•©ë‹ˆë‹¤</button>
            </form>
        </div>
    </div>
</div>

<script>
    function openLeaveModal() {
        document.getElementById('leaveModal').style.display = 'flex';
    }
    function closeLeaveModal() {
        document.getElementById('leaveModal').style.display = 'none';
    }

    window.addEventListener('click', function(event) {
        if (event.target == document.getElementById('leaveModal')) {
            closeLeaveModal();
        }
    });
</script>

</body>
</html>