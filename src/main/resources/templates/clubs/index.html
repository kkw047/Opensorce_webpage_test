<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Team11 – 모임 플랫폼</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
    <script defer th:src="@{/js/main.js}"></script>
</head>
<body>
<div class="container">
    <div class="app">

        <!-- 1.1 Header -->
        <header class="header">
            <div class="brand">
                <span class="dot"></span>
                <span>Team11 모임</span>
            </div>
            <div class="header-actions">
                <button id="openLogin" class="btn">로그인</button>
                <button id="openRegister" class="btn btn-primary">회원가입</button>
            </div>
        </header>

        <!-- 1.2 Search -->
        <section class="search">
            <select id="srchDo" class="input">
                <option value="">도(전체)</option>
            </select>
            <select id="srchSi" class="input">
                <option value="">시/군/구(전체)</option>
            </select>
            <input id="srchKw" class="input" type="text" placeholder="키워드 (이름/설명)">
            <button id="btnSearch" class="btn btn-primary">검색</button>
        </section>

        <!-- 1.3 Sidebar -->
        <aside class="sidebar">
            <div>
                <div style="font-weight:800;margin-bottom:8px">메인 메뉴</div>
                <div class="menu">
                    <div id="menuMain" class="item active">메인</div>
                    <div id="menuRec" class="item">추천</div>
                    <div id="menuCal" class="item">캘린더</div>
                    <div id="menuMine" class="item">내 모임</div>
                </div>
            </div>

            <div>
                <div style="font-weight:800;margin:10px 0 8px">카테고리 필터</div>
                <div id="sideCats" class="cat-list"><div class="muted">로딩중…</div></div>
            </div>

            <div style="margin-top:auto">
                <button id="menuMake" class="btn btn-primary" style="width:100%">모임 만들기</button>
            </div>
        </aside>

        <!-- 1.4 Content -->
        <main id="content" class="content">
            <div class="card">
                <h2 style="margin:0 0 10px 0;">모임</h2>
                <div id="clubList" class="cards"></div>
            </div>
        </main>

    </div>
</div>

<!-- ===== 로그인 모달 ===== -->
<div id="loginModal" class="modal">
    <div class="dialog">
        <div class="head">
            <div style="font-weight:700">로그인</div>
            <button class="btn" data-close="loginModal">닫기</button>
        </div>
        <div class="body">
            <form th:action="@{/auth/login}" method="post" class="grid" style="gap:12px">
                <div class="form-row">
                    <label>아이디</label>
                    <input class="input" type="text" name="loginId" required>
                </div>
                <div class="form-row">
                    <label>비밀번호</label>
                    <input class="input" type="password" name="password" required>
                </div>
                <div class="foot" style="padding:0;text-align:right">
                    <button class="btn btn-primary" type="submit">로그인</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ===== 회원가입 모달 ===== -->
<div id="registerModal" class="modal">
    <div class="dialog">
        <div class="head">
            <div style="font-weight:700">회원가입</div>
            <button class="btn" data-close="registerModal">닫기</button>
        </div>
        <div class="body">
            <form th:action="@{/auth/register}" method="post" class="grid" style="gap:12px">
                <div class="form-grid">
                    <div class="form-row">
                        <label>이메일</label>
                        <input class="input" type="email" name="email" required>
                    </div>
                    <div class="form-row">
                        <label>닉네임</label>
                        <input class="input" type="text" name="nickname" required>
                    </div>
                    <div class="form-row">
                        <label>아이디</label>
                        <div style="display:flex;gap:8px">
                            <input id="regLoginId" class="input" type="text" name="loginId" required>
                            <button id="btnCheckId" class="btn" type="button">중복검사</button>
                        </div>
                        <span id="idHelp" class="help" style="color:#64748b"></span>
                    </div>
                    <div class="form-row">
                        <label>비밀번호</label>
                        <input class="input" type="password" name="password" required>
                    </div>
                </div>

                <div class="form-row">
                    <label>관심 카테고리 (체크 다중 선택)</label>
                    <div id="regCats" class="cat-list"><div class="muted">로딩중…</div></div>
                </div>

                <div class="foot" style="padding:0;text-align:right">
                    <button class="btn btn-primary" type="submit">가입하기</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:inline="javascript">
    // 아이디 중복검사 (서버에서 /auth/check-login-id?loginId=… 제공 가정)
    document.addEventListener('DOMContentLoaded', ()=>{
        const btn = document.getElementById('btnCheckId');
        if(!btn) return;
        btn.addEventListener('click', async ()=>{
            const v = document.getElementById('regLoginId').value.trim();
            const help = document.getElementById('idHelp');
            if(!v){ help.textContent='아이디를 입력하세요'; help.style.color='#ef4444'; return; }
            try{
                const r = await fetch(/*[[@{/auth/check-login-id}]]*/'/auth/check-login-id?loginId='+encodeURIComponent(v));
                if(r.ok){ help.textContent='사용 가능한 아이디입니다.'; help.style.color='#16a34a'; }
                else { help.textContent='이미 사용 중입니다.'; help.style.color='#ef4444'; }
            }catch{ help.textContent='확인 실패'; help.style.color='#ef4444'; }
        });
    });
</script>
</body>
</html>
