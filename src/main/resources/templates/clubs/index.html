<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>모임 메인</title>
    <link rel="stylesheet" th:href="@{/css/app.css}" href="/css/app.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>
<body>

<!-- 1. 맨위: 로그인/회원가입 버튼 (팝업) -->
<header class="topbar">
    <div class="brand">TEAM11 모임</div>
    <div class="auth-actions">
        <button id="btnLoginOpen" type="button">로그인</button>
        <button id="btnRegOpen" type="button">회원가입</button>
    </div>
</header>

<!-- 2. 검색: 도/시군구 + 키워드 -->
<section class="searchbar">
    <div class="region-row">
        <label for="searchDo">도</label>
        <select id="searchDo"></select>

        <label for="searchSi">시/군/구</label>
        <select id="searchSi"></select>
    </div>
    <div class="keyword-row">
        <input id="searchKeyword" type="text" placeholder="키워드 (모임명/소개)"/>
        <button id="btnSearch" type="button">검색</button>
        <button id="btnReset" type="button">전체보기</button>
    </div>
</section>

<main class="layout">
    <!-- 3. 좌측 메뉴바 (세로) -->
    <aside class="sidebar">
        <nav class="main-menu">
            <a class="active">메인</a>
            <a>추천</a>
            <a>캘린더</a>
            <a>내 모임</a>
        </nav>

        <section class="cats">
            <h4>카테고리</h4>
            <div class="cat-list">
                <div th:each="cat : ${categories}">
                    <label>
                        <input type="checkbox" name="cat" th:value="${cat.id}"/>
                        <span th:text="${cat.name}">카테고리</span>
                    </label>
                </div>
            </div>
        </section>

        <div class="make-club">
            <a th:href="@{/clubs/create}" class="btn">모임 만들기</a>
        </div>
    </aside>

    <!-- 4. 우측 모임 카드 -->
    <section class="cards" id="clubCards">
        <!-- 초기 서버 렌더링 (JS로도 대체됨) -->
        <article class="card" th:each="c : ${clubs}">
            <div class="thumb">
                <img th:src="@{|/clubs/${c.id}/image|}" alt="club image"/>
            </div>
            <div class="info">
                <h3 th:text="${c.name}">모임명</h3>
                <p class="desc" th:text="${c.description}">소개</p>
                <p class="region">
                    <span th:text="${c.regionDo}">도</span>
                    <span th:text="${c.regionSi}">시군구</span>
                </p>
                <div class="chips">
                    <span class="chip" th:each="k : ${c.categories}" th:text="${k.name}">카테고리</span>
                </div>
            </div>
        </article>
    </section>
</main>

<!-- 로그인 모달 -->
<div class="modal" id="loginModal" hidden>
    <div class="modal__content">
        <h3>로그인</h3>
        <form id="loginForm">
            <label>이메일
                <input name="email" type="email" required/>
            </label>
            <label>비밀번호
                <input name="password" type="password" required/>
            </label>
            <div class="modal__actions">
                <button type="submit">로그인</button>
                <button type="button" data-close>닫기</button>
            </div>
            <p class="form-msg" id="loginMsg"></p>
        </form>
    </div>
</div>

<!-- 회원가입 모달 -->
<div class="modal" id="regModal" hidden>
    <div class="modal__content">
        <h3>회원가입</h3>
        <form id="regForm">
            <label>닉네임
                <input name="nickname" required/>
            </label>
            <label>이메일
                <input name="email" type="email" required/>
            </label>
            <label>비밀번호
                <input name="password" type="password" required minlength="6"/>
            </label>

            <fieldset class="cat-select">
                <legend>관심 카테고리(복수 선택)</legend>
                <div th:each="cat : ${categories}">
                    <label>
                        <input type="checkbox" name="categoryIds" th:value="${cat.id}"/>
                        <span th:text="${cat.name}">카테고리</span>
                    </label>
                </div>
            </fieldset>

            <div class="modal__actions">
                <button type="submit">가입</button>
                <button type="button" data-close>닫기</button>
            </div>
            <p class="form-msg" id="regMsg"></p>
        </form>
    </div>
</div>

<script th:src="@{/js/region.js}" src="/js/region.js"></script>
<script th:src="@{/js/main.js}" src="/js/main.js"></script>
<script>
    // 지역 셀렉트 초기화
    window.__initRegions('searchDo', 'searchSi');
</script>
</body>
</html>
